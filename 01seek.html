<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Craig-Reynolds Algorithm</title>
  <link rel="stylesheet" href="sliderStyle.css" />
  <link rel="stylesheet" href="desert.css" />
  <link rel="stylesheet" href="pagesLayoutStyle.css" />
  <link rel="stylesheet" href="button.css" />
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="mouse.js"></script>
  <script src="vector.js"></script>
  <script src="vehicle.js"></script>
  <script src="sliderStyle.js"></script>
  <!--To disable focusing on Chrome browser -->
  <script type="text/javascript">
    document.addEventListener('click', function (e) {
      if (document.activeElement.toString() == '[object HTMLButtonElement]') { document.activeElement.blur(); }
    });
  </script>
</head>

<body style=" background-color: hsl(117, 43%, 80%);">

  <div class="box" style="float: left; width: auto; height: auto;">
          <div class="box" style="color: black; background: #53d8cd;width: 95%;height: 20px;font-size: 4.7mm;text-align: center;
          margin-left: 0px;padding-left: 0px;padding-right: 0px;margin-bottom: 8px;">
              Simulations
          </div>
  
          <div class="box" style="color: black; background: #53d8cd;width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
                  margin-left: 0px;padding-left: 0px;padding-right: 0px;margin-bottom: 5px;">
              Basic behaviors
          </div>
  
          <div class="container">
              <button class="button" onclick='window.location.href = "./01seek.html"'>
                  Seek
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./02flee.html"'>
                  Flee
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./03arrive.html"'>
                  Arrival
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./04pursue_evade.html"'>
                  Pursue and Evade
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./05wander.html"'>
                  Wander
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./06obstacle_avoid.html"'>
                  Obstacle Avoidance
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./07containment.html"'>
                  Containment
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./08wall_follow.html"'>
                  Wall Following
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./09Path_Following.html"'>
                  Path Following
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./10flow.html"'>
                  Flow Field Following
              </button>
          </div>
  
          <div class="box" style="color: black; background: #53d8cd;width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
                  margin-left: 0px;padding-left: 0px;padding-right: 0px;margin-bottom: 5px;
                  margin-top: 5px;">
              Combined behaviors
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./11CrowdPathFollow.html"'>
                  Crowd Path Following
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./12leader.html"'>
                  Leader Following
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./13unalignedAvoidence.html"'>
                  Unaligned Collision Avoidance
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./14queue.html"'>
                  Queueing
              </button>
          </div>
          <div class="container">
              <button class="button" onclick='window.location.href = "./15flock.html"'>
                  Flocking
              </button>
          </div>
          </nav>
  </div>

    <div id="backToHome" class="container" style=" display: inline-block;">

      <!--BUTTON DISPLAY FORCES-->
      <button id="Forces" class="button">
        Display Forces
      </button>
        
      <!--BUTTON FREEZE-->
      <button id="Freeze" class="button">
        Freeze
      </button>
      
    </div>
  
    <div style="display: block;">
      <div id="main" class="box" style="display: block; width: 800px; padding-right: 0px;">

        <div class="box" style="width: 90%;height:  auto;font-size: 4.7mm;text-align: center;
        margin-left: 0px;padding-left: 0px;padding-right: 0px;">
        The seek method calculates and returns vector that will be applied to the current velocity of Vehicle.
        The orange vector pointing out of the center of Vehicle is visualization of the desired_velocity and the blue one shows current velocity vector.
        </div>

        <canvas id="VP" class="viewport" style="background: #eee; width: 100%; position: relative;height: 50%;"></canvas>

        <!--OUTPUT OF MOUSE POSITIONS OF CANVAS-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
          margin-left: 0px;padding-left: 0px;padding-right: 0px;">

          Mouse position x:
          <span id="mouse_posX"></span>
          y:
          <span id="mouse_posY"></span>

        </div>

        <!--OUTPUT OF VEHICLE POSITION & VELOCITY-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
          margin-left: 0px;padding-left: 0px;padding-right: 0px; top: -4px;">

          Vehicle position x:
          <span id="vehicle_posX"></span>
          y:
          <span id="vehicle_posY"></span>
          Vehicle velocity :
          <span id="vehicle_vel"></span>

        </div>

        <!--RANGE SLIDER OF MAXSPEED-->
        <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

          <div class="box">Maxspeed</div>

          <input id="maxspeed" class="range-slider__range" type="range" value="4" min="0" max="7" step="0.01">

          <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>

        </div>

        <!--RANGE SLIDER OF MAXFORCE-->
        <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

          <div class="box">Maxforce</div>

          <input id="maxforce" class="range-slider__range" type="range" value="0.1" min="0" max="5" step="0.01">

          <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>

        </div>

        <script>
          //CHANGE WIDTH & HEIGHT OF CANVAS
          var canvas = document.getElementById('VP'),
            ctx = canvas.getContext('2d');
          canvas.height = 300;
          canvas.width = 800;

          //READ & WRITE MOUSE POSITION
          mouseObj.Init("#VP");
          $(canvas).on("mousemove", function (event) {
            $("#mouse_posX").text(" " + mouseObj.x);
            $("#mouse_posY").text(" " + mouseObj.y);
          });

          //READ IF BUTTON "DISPLAY FORCE" WAS CLICKED
          var displayForces = 'off';
          document.getElementById("Forces").addEventListener('click', function () {
            if (displayForces == 'on') {
              displayForces = 'off';
            }
            else {
              displayForces = 'on';
            }
          }, false);

          //READ IF BUTTON "FREEZE" WAS CLICKED
          var freeze = "off";
          document.getElementById("Freeze").addEventListener('click', function freezer() {
            if (freeze == 'on') {
              freeze = 'off';
              document.getElementById("Freeze").innerHTML = "Freeze OFF";
            }
            else {
              freeze = 'on';
              document.getElementById("Freeze").innerHTML = "Freeze ON";
            }
          }, false);

          //READ IF BUTTON "FREEZE" WAS KEYPRESSED
          document.body.addEventListener("keypress", function (k) {
            if (k.keyCode == 32) {
              if (freeze == 'on') {
                freeze = 'off';
                document.getElementById("Freeze").innerHTML = "Freeze OFF";
              }
              else {
                freeze = 'on';
                document.getElementById("Freeze").innerHTML = "Freeze ON";
              }
            }
          }, false);

          rangeSliderInit();

          //INIT VEHICLE
          var vehicle = new Vehicle(100, 100);
          vehicle.radius = 30;

          //LOOP FUNC
          function draw() {

            ctx.setTransform(1, 0, 0, 1, 0, 0); // <- JS magic for PathBegin()..
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            vehicle.maxforce = document.getElementById("maxforce").value;
            vehicle.maxspeed = document.getElementById("maxspeed").value;
            vehicle.seek(mouseObj.x, mouseObj.y, displayForces = displayForces);

            if (freeze == 'off') {
              vehicle.update();
            }

            if (displayForces == 'on') {
              vehicle.renderCircleAround(mouseObj.x, mouseObj.y, 5);
            }
            vehicle.renderVehicle();

            document.getElementById("snipSpeed").innerHTML = vehicle.maxspeed;
            document.getElementById("snipForce").innerHTML = vehicle.maxforce;
            $("#vehicle_posX").text(Math.ceil(vehicle.position.x));
            $("#vehicle_posY").text(Math.ceil(vehicle.position.y));
            $("#vehicle_vel").text((vehicle.velocity.length()).toFixed(2));

          }
          setInterval(draw, 30);
        </script>

      </div>

      <div id="codeSnippet" class="box" style="text-align: left; display: block;" >

        <!--CREATES SNIPPET OF CODE-->
        <pre class="prettyprint linenums" style="position: inherit;margin-top: 2px;margin-bottom: 2px;">
    class Vehicle {
      constructor(x, y) {
        this.acceleration = new Vector(0, 0),
        this.velocity = new Vector(0, 0),
        this.position = new Vector(x, y),
        this.radius = 30,
        this.maxspeed = <b id="snipSpeed" style="color: #cd5c5c">4</b>,
        this.maxforce = <b id="snipForce" style="color: #cd5c5c">0.1</b>;
        this.desired_velocity = new Vector(0, 0);
      }
      update() {
        this.velocity = this.velocity.add(this.acceleration);
        this.velocity.limit(this.maxspeed);
        this.position = this.position.add(this.velocity);
        this.acceleration = this.acceleration.multiply(0);
      }
      applyForce(force) {
        this.acceleration = this.acceleration.add(force);
      }
      seek(targetX = mouseObj.x, targetY = mouseObj.y) {
        this.desired_velocity = new Vector(targetX, targetY);
        this.desired_velocity = this.desired_velocity.subtract(this.position);
        this.desired_velocity = this.desired_velocity.normalize();
        this.desired_velocity = this.desired_velocity.multiply(this.maxspeed);
        this.steering_force = this.desired_velocity.subtract(this.velocity);
        this.steering_force.limit(this.maxforce);
        this.applyForce(this.steering_force);
        return this.steering_force;
      }
    }</pre>
      </div>
    </div>
</body>

</html>