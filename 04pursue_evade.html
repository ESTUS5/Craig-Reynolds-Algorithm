<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Craig-Reynolds Algorithm</title>
    <link rel="stylesheet" href="sliderStyle.css" />
    <link rel="stylesheet" type="text/css" href="desert.css" />
    <link rel="stylesheet" href="pagesLayoutStyle.css" />
    <link rel="stylesheet" href="button.css" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="vector.js"></script>
    <script src="mouse.js"></script>
    <script src="vehicle.js"></script>
    <script src="sliderStyle.js"></script>
    <!--To disable focusing on Chrome browser -->
    <script type="text/javascript">
        document.addEventListener('click', function (e) {
            if (document.activeElement.toString() == '[object HTMLButtonElement]') { document.activeElement.blur(); }
        });
    </script>
</head>

<body style="margin:0;padding:0;overflow:hidden; background-color: hsl(117, 43%, 80%);">

    <div id="backToHome" class="container" >
        
        <!--BUTTON BACK TO HOME PAGE/ANCHOR-->
        <button class="button" onclick='window.location.href = "./00home.html"'>
            Back to home page
        </button>

        <!--BUTTON DISPLAY FORCES-->
        <button id="Forces" class="button">
            Display Forces
        </button>
            
        <!--BUTTON FREEZE-->
        <button id="Freeze" class="button">
            Freeze
        </button>

        <!--BUTTON CHANGE ALGORITHM -->
        <button id="change" class="button">
            Pursue
        </button>

    </div>

    <div id="main" class="container" style="display: inline-block;width: 50%;padding-right: 0px;">
        
        <canvas id="VP" class="viewport" style="background: #eee; width: 100%;height: 300px;"></canvas>

        <!--OUTPUT OF MOUSE POSITIONS OF CANVAS-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
              margin-left: 0px;padding-left: 0px;padding-right: 0px;">

            Red <span name="red">Pursuer</span> position x:
            <span id="pursuer_posX"></span>
            y:
            <span id="pursuer_posY"></span>
            velocity :
            <span id="pursuer_vel"></span>

        </div>

        <!--OUTPUT OF VEHICLE POSITION & VELOCITY-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
              margin-left: 0px;padding-left: 0px;padding-right: 0px; top: -4px;">

            Blue <span name="blue">Target</span> position x:
            <span id="evader_posX"></span>
            y:
            <span id="evader_posY"></span>
            velocity :
            <span id="evader_vel"></span>

        </div>

        <div>

            <!--RANGE SLIDER OF MAXSPEED OF PURSUER/CHASER-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

                <div class="box">
                    Maxspeed of <span name="red">Pursuer</span>
                </div>

                <input id="maxspeed1" class="range-slider__range" type="range" min="0" max="7" step="0.01">
            
                <span id="span1a" class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>

            <!--RANGE SLIDER OF MAXFORCE PURSUER/CHASER-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">
                
                <div class="box">
                    Maxforce of <span name="red">Pursuer</span>
                </div>

                <input id="maxforce1" class="range-slider__range" type="range" min="0" max="5" step="0.01">
                
                <span id="span1b" class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>

        </div>

        <div>

            <!--RANGE SLIDER OF MAXSPEED TARGET/EVADER-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

                <div class="box">
                    Maxspeed of <span name="blue">Target</span>
                </div>

                <input id="maxspeed2" class="range-slider__range" type="range" min="0" max="7" step="0.01">
                
                <span id="span2a" class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>

            <!--RANGE SLIDER OF MAXFORCE TARGET/EVADER-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">
                
                <div class="box">
                    Maxforce of <span name="blue">Target</span>
                </div>

                <input id="maxforce2" class="range-slider__range" type="range" min="0" max="5" step="0.01">
                
                <span id="span2b" class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>
            
        </div>

        <script>
            //CHANGE WIDTH & HEIGHT OF CANVAS
            var canvas = document.querySelector('.viewport'),
                ctx = canvas.getContext('2d');
            canvas.width = screen.width / 2;
            canvas.height = 300;

            //INIT MOUSE POS
            mouseObj.Init("#VP");

            // SET RANDOM VALUES FOR VEHICLES
            document.getElementById("maxforce1").value = Math.random() * 5;
            document.getElementById("maxspeed1").value = Math.random() * 7;
            document.getElementById("maxforce2").value = Math.random() * 5;
            document.getElementById("maxspeed2").value = Math.random() * 7;
            document.getElementById("span1a").textContent = document.getElementById("maxspeed1").value;
            document.getElementById("span1b").textContent = document.getElementById("maxforce1").value;
            document.getElementById("span2a").textContent = document.getElementById("maxspeed2").value;
            document.getElementById("span2b").textContent = document.getElementById("maxforce2").value;

            //INIT VEHICLE
            var vehicle = new Vehicle(Math.random() * canvas.width, Math.random() * canvas.height);
            var vehicle2 = new Vehicle(Math.random() * canvas.width, Math.random() * canvas.height);
            var randomTarget = new Vector(Math.ceil(Math.random() * canvas.width), Math.ceil(Math.random() * canvas.height));

            //READ IF BUTTON "PURSUE/EVADER" WAS CLICKED
            var option = 'pursuer';
            document.getElementById("change").addEventListener('click', function () {
                if (option == 'pursuer') {
                    option = 'evader';
                    document.getElementById("change").textContent = 'Evade';
                }
                else if (option == 'evader') {
                    option = 'pursuer';
                    document.getElementById("change").textContent = 'Pursue';
                }
            }, false);
            
            //READ IF BUTTON "DISPLAY FORCE" WAS CLICKED
            var displayForces = 'off';
            document.getElementById("Forces").addEventListener('click', function () {
                if (displayForces == 'on') {
                    displayForces = 'off';
                }
                else {
                    displayForces = 'on';
                }
            }, false);

            //READ IF BUTTON "FREEZE" WAS CLICKED
            var freeze = "off";
            document.getElementById("Freeze").addEventListener('click', function freezer() {
                if (freeze == 'on') {
                freeze = 'off';
                document.getElementById("Freeze").innerHTML = "Freeze OFF";
                }
                else {
                freeze = 'on';
                document.getElementById("Freeze").innerHTML = "Freeze ON";
                }
            }, false);

            //READ IF BUTTON "FREEZE" WAS KEYPRESSED
            document.body.addEventListener("keypress", function (k) {
                if (k.keyCode == 32) {
                if (freeze == 'on') {
                    freeze = 'off';
                    document.getElementById("Freeze").innerHTML = "Freeze OFF";
                }
                else {
                    freeze = 'on';
                    document.getElementById("Freeze").innerHTML = "Freeze ON";
                }
                }
            }, false);

            rangeSliderInit();

            //LOOP FUNC
            function draw() {

                if (vehicle.position.distanceBetweenPoints(vehicle2.position) < 3) {

                    // SET RANDOM VALUES FOR VEHICLES
                    document.getElementById("maxforce1").value = Math.random() * 5;
                    document.getElementById("maxspeed1").value = Math.random() * 7;
                    document.getElementById("maxforce2").value = Math.random() * 5;
                    document.getElementById("maxspeed2").value = Math.random() * 7;
                    document.getElementById("span1a").textContent = document.getElementById("maxspeed1").value;
                    document.getElementById("span1b").textContent = document.getElementById("maxforce1").value;
                    document.getElementById("span2a").textContent = document.getElementById("maxspeed2").value;
                    document.getElementById("span2b").textContent = document.getElementById("maxforce2").value;

                    //INIT VEHICLE
                    vehicle = new Vehicle(Math.random() * canvas.width, Math.random() * canvas.height);
                    vehicle2 = new Vehicle(Math.random() * canvas.width, Math.random() * canvas.height);
                    randomTarget = new Vector(Math.random() * canvas.width, Math.random() * canvas.height);
                
                }

            document.getElementById("VP").addEventListener('mousedown', function () {
                randomTarget = new Vector(mouseObj.x, mouseObj.y);
            }, false);

                ctx.setTransform(1, 0, 0, 1, 0, 0); // <- JS magic for PathBegin()..
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                var r = document.getElementsByName("red"),
                    b = document.getElementsByName("blue");

                if (option === 'pursuer') {
                    vehicle.pursue(vehicle2.position, vehicle2.velocity, displayForces);
                    vehicle2.seek(randomTarget.x, randomTarget.y, displayForces);
                    for (let index = 0; index < r.length; index++) {
                        r[index].innerHTML = 'Pursuer';
                        b[index].innerHTML = 'Target';
                    }
                }

                else {
                    vehicle.seek(vehicle2.position.x, vehicle2.position.y, displayForces);
                    vehicle2.evade(vehicle.position, vehicle.velocity, displayForces);
                    for (let index = 0; index < r.length; index++) {
                        r[index].innerHTML = 'Chaser';
                        b[index].innerHTML = 'Evader';
                    }
                }

                vehicle.onlyCanvas();
                vehicle2.onlyCanvas();
               
               if (freeze == 'off') {
                    vehicle.update();
                    vehicle2.update();
                }

                vehicle.renderVehicle(colour = 'rgba(200,0,0,0.5)');
                vehicle2.renderVehicle();

                vehicle.maxforce = document.getElementById("maxforce1").value;
                vehicle.maxspeed = document.getElementById("maxspeed1").value;
                vehicle2.maxforce = document.getElementById("maxforce2").value;
                vehicle2.maxspeed = document.getElementById("maxspeed2").value;

                $("#pursuer_posX").text(Math.ceil(vehicle.position.x));
                $("#pursuer_posY").text(Math.ceil(vehicle.position.y));
                $("#pursuer_vel").text(vehicle.velocity.length().toFixed(2));
                $("#evader_posX").text(Math.ceil(vehicle2.position.x));
                $("#evader_posY").text(Math.ceil(vehicle2.position.y));
                $("#evader_vel").text(vehicle2.velocity.length().toFixed(2));
            }
            setInterval(draw, 50);
        </script>

    </div>

    <div id="codeSnippet" class="container" style="float: right; width: 49%; margin: 2px;">

        <!--CREATES SNIPPET OF CODE-->
        <pre class="prettyprint linenums" style="position: inherit;margin-top: 0px;margin-bottom: 0px;">
class Vehicle 
{
  constructor(x, y) {
    this.acceleration = new Vector(0, 0),
    this.velocity = new Vector(0, 0),
    this.position = new Vector(x, y),
    this.radius = 10,
    this.maxspeed = 4,
    this.maxforce = 0.1;
    this.desired_velocity = new Vector(0, 0);
  }
  update() {
    this.velocity = this.velocity.add(this.acceleration);
    this.velocity.limit(this.maxspeed);
    this.position = this.position.add(this.velocity);
    this.acceleration = this.acceleration.multiply(0);
  }
  applyForce(force) {
    this.acceleration = this.acceleration.add(force);
  }
  pursue(target_position, target_velocity) {
    var distance = this.position.distanceBetweenPoints(target_position);
    var predictedTargetPosition = distance / this.maxspeed;
    var target = target_position.add(target_velocity.multiply(predictedTargetPosition))
    this.seek(target.x, target.y);
  }
  evade(target_position, target_velocity) {
    var distance = this.position.distanceBetweenPoints(target_position);
    var predictedTargetPosition = distance / this.maxspeed;
    var target = target_position.add(target_velocity.multiply(predictedTargetPosition))
    this.flee(target.x, target.y);
  }
}</pre>
    </div>
</body>
</html>