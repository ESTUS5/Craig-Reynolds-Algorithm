<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Craig-Reynolds Algorithm</title>
    <link rel="stylesheet" href="sliderStyle.css" />
    <link rel="stylesheet" type="text/css" href="desert.css" />
    <link rel="stylesheet" href="pagesLayoutStyle.css" />
    <link rel="stylesheet" href="button.css" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="vector.js"></script>
    <script src="mouse.js"></script>
    <script src="vehicle.js"></script>
    <script src="sliderStyle.js"></script>
    <!--To disable focusing on Chrome browser -->
    <script type="text/javascript">
        document.addEventListener('click', function (e) {
            if (document.activeElement.toString() == '[object HTMLButtonElement]') { document.activeElement.blur(); }
        });
    </script>
</head>

<body style="margin:0;padding:0;overflow:hidden; background-color: hsl(117, 43%, 80%);">

    <div id="backToHome" class="container">

        <!--BUTTON BACK TO HOME PAGE/ANCHOR-->
        <button class="button" onclick='window.location.href = "./00home.html"'>
            Back to home page
        </button>

        <!--BUTTON DISPLAY FORCES-->
        <button id="Forces" class="button">
            Display Forces
        </button>
        
        <!--BUTTON FREEZE-->
        <button id="Freeze" class="button">
            Freeze
        </button>

    </div>

    <div id="main" class="container" style="display: inline-block;width: 50%;padding-right: 0px;">
        
        <canvas id="VP" class="viewport" style="background: #eee; width: 100%;"></canvas>

        <!--OUTPUT OF VEHICLE POSITION & VELOCITY-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
        margin-left: 0px;padding-left: 0px;padding-right: 0px;">

            Vehicle position x:
            <span id="vehicle_posX"></span>
            y:
            <span id="vehicle_posY"></span>
            velocity:
            <span id="vehicle_vel"></span>

        </div>

        <div>
            <!--RANGE SLIDER OF MAXSPEED-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

                <div class="box">Maxspeed</div>
                
                <input id="maxspeed" class="range-slider__range" type="range" value="2" min="0" max="7" step="0.01">
                
                <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>

            <!--RANGE SLIDER OF MAXFORCE-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">
                
                <div class="box">Maxforce</div>
                
                <input id="maxforce" class="range-slider__range" type="range" value="0.1" min="0" max="5" step="0.01">
                
                <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>
           
            </div>

        </div>

        <div>
            <!--RANGE SLIDER OF LENGTH-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

                <div class="box">Length</div>

                <input id="L" class="range-slider__range" type="range" value="50" min="0">

                <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>

            </div>
            <!--RANGE SLIDER OF LENGTH-->
            <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">
                
                <div class="box">Radius</div>
                
                <input id="r" class="range-slider__range" type="range" value="20" min="0">
                
                <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>
            
            </div>
        
        </div>

        <script>

            //CHANGE WIDTH & HEIGHT OF CANVAS
            var canvas = document.querySelector('.viewport'),
                ctx = canvas.getContext('2d');
            canvas.width = screen.width / 2;
            canvas.height = 300;

            //INIT VEHICLE
            var vehicle = new Vehicle(100, 100);
            vehicle.theta = Math.random() * 360;

            //READ IF BUTTON "DISPLAY FORCE" WAS CLICKED
            var displayForces = 'off';
            document.getElementById("Forces").addEventListener('click', function () {
                if (displayForces == 'on') {
                    displayForces = 'off';
                }
                else {
                    displayForces = 'on';
                }
            }, false);

            //READ IF BUTTON "FREEZE" WAS CLICKED
            var freeze = "off";
            document.getElementById("Freeze").addEventListener('click', function freezer() {
                if (freeze == 'on') {
                freeze = 'off';
                document.getElementById("Freeze").innerHTML = "Freeze OFF";
                }
                else {
                freeze = 'on';
                document.getElementById("Freeze").innerHTML = "Freeze ON";
                }
            }, false);

            //READ IF BUTTON "FREEZE" WAS KEYPRESSED
            document.body.addEventListener("keypress", function (k) {
                console.log(k.keyCode, k.key, displayForces, freeze)
                if (k.keyCode == 32) {
                if (freeze == 'on') {
                    freeze = 'off';
                    document.getElementById("Freeze").innerHTML = "Freeze OFF";
                }
                else {
                    freeze = 'on';
                    document.getElementById("Freeze").innerHTML = "Freeze ON";
                }
                }
            }, false);

            rangeSliderInit();

            //LOOP FUNC
            var ArrVector = [];
            function draw() {

                ctx.setTransform(1, 0, 0, 1, 0, 0); // <- JS magic for PathBegin()..
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                vehicle.maxforce = document.getElementById("maxforce").value;
                vehicle.maxspeed = document.getElementById("maxspeed").value;

                vehicle.outOfBounds();

                if (freeze == 'off') {
                    ArrVector = vehicle.wander(document.getElementById("L").value,
                    document.getElementById("r").value, displayForces);
                    vehicle.update();
                }
                else{
                    console.log("HUJ")
                    ctx.beginPath();
                    ctx.moveTo(vehicle.position.x, vehicle.position.y);
                    ctx.lineTo(ArrVector[0].x, ArrVector[0].y);
                    ctx.strokeStyle = "rgba(150,0,0,0.5)";
                    ctx.stroke();
                    ctx.closePath();
                    ctx.beginPath();
                    ctx.moveTo(vehicle.position.x, vehicle.position.y);
                    ctx.lineTo(ArrVector[1].x, ArrVector[1].y);
                    ctx.lineTo(ArrVector[0].x, ArrVector[0].y);
                    ctx.strokeStyle = "rgba(50,200,0,0.5)";
                    ctx.stroke();
                    ctx.closePath();
                    vehicle.renderCircleAround(ArrVector[1].x, ArrVector[1].y, document.getElementById("r").value);
                    vehicle.renderForces();
                }

                vehicle.renderVehicle();

                document.getElementById("snipSpeed").innerHTML = vehicle.maxspeed;
            document.getElementById("snipForce").innerHTML = vehicle.maxforce;
            document.getElementById("snipL").innerHTML = document.getElementById("L").value;
            document.getElementById("snipR").innerHTML = document.getElementById("r").value;
                $("#vehicle_posX").text(Math.ceil(vehicle.position.x));
                $("#vehicle_posY").text(Math.ceil(vehicle.position.y));
                $("#vehicle_vel").text((vehicle.velocity.length()).toFixed(2))
            }
            setInterval(draw, 50);

        </script>

    </div>

    <div id="codeSnippet" class="container" style="float: right; width: 49%; margin: 2px;">

        <!--CREATES SNIPPET OF CODE-->
        <pre class="prettyprint linenums" style="position: inherit;margin-top: 0px;margin-bottom: 0px;">
class Vehicle 
{
  constructor(x, y) {
    this.acceleration = new Vector(0, 0),
    this.velocity = new Vector(0, 0),
    this.position = new Vector(x, y),
    this.radius = 10,
    this.maxspeed = <b id="snipSpeed" style="color: #cd5c5c">4</b>,
    this.maxforce = <b id="snipForce" style="color: #cd5c5c">0.1</b>;
    this.desired_velocity = new Vector(0, 0);
  }
  update() {
    this.velocity = this.velocity.add(this.acceleration);
    this.velocity.limit(this.maxspeed);
    this.position = this.position.add(this.velocity);
    this.acceleration = this.acceleration.multiply(0);
  }
  applyForce(force) {
    this.acceleration = this.acceleration.add(force);
  }
  wander(length = <b id="snipL" style="color: #cd5c5c">30</b>, radius = <b id="snipR" style="color: #cd5c5c">25</b>) {
    var lengthVector = this.velocity.normalize();
    lengthVector = lengthVector.multiply(length);
    lengthVector = this.position.add(lengthVector);
    this.theta = this.theta + ((Math.random() * 5) - (5 * 0.5));
    var radiusVector = new Vector(Math.cos(this.theta) * radius,
    Math.sin(this.theta) * radius);
    radiusVector = lengthVector.add(radiusVector);
    this.seek(radiusVector.x,radiusVector.y,displayForces);
}</pre>
    </div>
</body>

</html>