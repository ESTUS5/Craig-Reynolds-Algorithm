<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Craig-Reynolds Algorithm</title>
    <link rel="stylesheet" href="sliderStyle.css" />
    <link rel="stylesheet" type="text/css" href="desert.css" />
    <link rel="stylesheet" href="pagesLayoutStyle.css" />
    <link rel="stylesheet" href="button.css" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="vector.js"></script>
    <script src="mouse.js"></script>
    <script src="vehicle.js"></script>
    <script src="sliderStyle.js"></script>
    <!--To disable focusing on Chrome browser -->
  <script type="text/javascript">
    document.addEventListener('click', function (e) {
      if (document.activeElement.toString() == '[object HTMLButtonElement]') { document.activeElement.blur(); }
    });
  </script>
    <script src="board.js"></script>
</head>

<body style="margin:0;padding:0;overflow:hidden; background-color: hsl(117, 43%, 80%);">

    <div id="backToHome" class="container">

      <!--BUTTON BACK TO HOME PAGE/ANCHOR-->
      <button class="button" onclick='window.location.href = "./00home.html"'>
        Back to home page
      </button>
      
      <!--BUTTON DISPLAY FORCES-->
      <button id="Forces" class="button">
        Display Forces
      </button>
        
      <!--BUTTON FREEZE-->
      <button id="Freeze" class="button">
        Freeze
      </button>

    </div>

    <div id="main" class="container" style="float: left; width: 50%; padding-right: 0px;">

        <canvas id="VP" class="viewport" style="background: #eee; width: 100%;"></canvas>

        <!--OUTPUT OF VEHICLE POSITION & VELOCITY-->
        <div class="box" style="width: 90%;height: 20px;font-size: 4.7mm;text-align: center;
        margin-left: 0px;padding-left: 0px;padding-right: 0px;">

            Vehicle position x:
            <span id="vehicle_posX"></span>
            y:
            <span id="vehicle_posY"></span>
            velocity:
            <span id="vehicle_vel"></span>

        </div>

        <!--RANGE SLIDER OF MAXSPEED-->
        <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">

          <div class="box">Maxspeed</div>

          <input id="maxspeed" class="range-slider__range" type="range" value="4" min="0" max="7" step="0.01">
            
          <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>
        
        </div>

        <!--RANGE SLIDER OF MAXFORCE-->
        <div class="range-slider" style="display: inline-block;top: 20px;margin-right: 70px;margin-left: 70px">
            
          <div class="box">Maxforce</div>
          
          <input id="maxforce" class="range-slider__range" type="range" value="0.1" min="0" max="5" step="0.01">
          
          <span class="range-slider__value" style="left: 140px;top: -21px;">0</span>
        
        </div>

        <script>
          //CHANGE WIDTH & HEIGHT OF CANVAS
          var canvas = document.querySelector('.viewport'),
            ctx = canvas.getContext('2d');
          canvas.width = screen.width / 2;
          canvas.height = 400;

          //READ MOUSE POSITION
          mouseObj.Init("#VP");

          //INIT VEHICLE
          var vehicle = new Vehicle(100, 100);
          
          //INIT BOARD
          var num_of_divs = 4;
          var move = "one";
          board = new Board(canvas.width, canvas.height, num_of_divs);
          board.create_vectors();

          //CHANGE VECTOR DIR IN TILE AFTER MOUSECLICK
          document.getElementById("VP").addEventListener('click', function () {
            if( move == "all"){    
              board.move_vectors(mouseObj);
            }
            else if (move == "one"){
              board.move_vector(mouseObj);
            }
          }, false);

          //READ IF BUTTON "DISPLAY FORCE" WAS CLICKED
          var displayForces = 'off';
          document.getElementById("Forces").addEventListener('click', function () {
            if(displayForces == 'on'){
              displayForces = 'off';
            }
            else{
              displayForces = 'on';
            }
          }, false);

          //READ IF BUTTON "FREEZE" WAS CLICKED
          var freeze = "off";
          document.getElementById("Freeze").addEventListener('click', function freezer() {
            if (freeze == 'on') {
              freeze = 'off';
              document.getElementById("Freeze").innerHTML = "Freeze OFF";
            }
            else {
              freeze = 'on';
              document.getElementById("Freeze").innerHTML = "Freeze ON";
            }
          }, false);

          //READ IF BUTTON "FREEZE" WAS KEYPRESSED
          document.body.addEventListener("keypress", function (k) {
            if (k.keyCode == 32) {
              if (freeze == 'on') {
                freeze = 'off';
                document.getElementById("Freeze").innerHTML = "Freeze OFF";
              }
              else {
                freeze = 'on';
                document.getElementById("Freeze").innerHTML = "Freeze ON";
              }
            }
          }, false);

          rangeSliderInit();

          //LOOP FUNC
          function draw() {

            ctx.setTransform(1, 0, 0, 1, 0, 0); // <- JS magic for PathBegin()..
            ctx.clearRect(0, 0, canvas.width, canvas.height);
                
            vehicle.maxforce = document.getElementById("maxforce").value;
            vehicle.maxspeed = document.getElementById("maxspeed").value;
            
            target = board.tile(vehicle.position.x, vehicle.position.y);
            
            if(displayForces=="on"){
              vehicle.renderVectorTo(target[0], target[1],"rgba(40,80,60,0.5)");
            }
            
            vehicle.seek(target[0], target[1],displayForces);
            if (freeze == 'off') {
              vehicle.update();
            }
            
            vehicle.onlyCanvas();
            vehicle.renderVehicle();
            vehicle.renderCircleAround(mouseObj.x,mouseObj.y);
            board.draw();

            $("#vehicle_posX").text(Math.ceil(vehicle.position.x));
            $("#vehicle_posY").text(Math.ceil(vehicle.position.y));
            $("#vehicle_vel").text((vehicle.velocity.length()).toFixed(2))

          }

          setInterval(draw, 14);
        </script>

    </div>

    <div id="codeSnippet" class="container" style="float: right; width: 49%; margin: 2px;">
        <!--CREATES SNIPPET OF CODE-->
        <pre class="prettyprint linenums" style="position: inherit;margin-top: 0px;margin-bottom: 0px;">
class Board{
 tile(obj_posX, obj_posY) {
  for (let x = 0; x < this.divisions; x++) {
   if (obj_posX < this.vectors_arr[x][0][2]) {
    for (let y = 0; y < this.divisions; y++) {
     if (obj_posY < this.vectors_arr[x][y][3]) {
      if (this.vectors_arr[x][y][0] > (this.vectors_arr[x][y][2]
       - (canvas.width/(this.divisions*2)))) {
       var bx = this.vectors_arr[x][y][2] + 1;
      }
      else {
       var bx = this.vectors_arr[x][y][2]
             - (canvas.width/this.divisions) - 1;
      }
      var a = (this.vectors_arr[x][y][1] - (this.vectors_arr[x][y][3]
       - (canvas.height/(this.divisions*2)))) / (this.vectors_arr[x][y][0]
        - (this.vectors_arr[x][y][2] - (canvas.width/(this.divisions*2))));
      if (a == Infinity || a == -Infinity) {
       a = 0;
      }
      var b = obj_posY - a * obj_posX;
      var by = a * bx + b;
      if (by > this.vectors_arr[x][y][3]) {
       by = this.vectors_arr[x][y][3];
       bx = (by - b) / a;
      }
      else if (by < this.vectors_arr[x][y][3]
         - (canvas.height/this.divisions)) {
       by = this.vectors_arr[x][y][3] - (canvas.height/this.divisions);
       bx = (by - b) / a;
      }
      return [bx, by];
     }
    }
}}}}
target = board.tile(vehicle.position.x, vehicle.position.y)
vehicle.seek(target[0], target[1]);</pre>
    </div>
    
</body>

</html>